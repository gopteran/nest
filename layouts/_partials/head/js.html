<!-- FlexSearch for client-side search -->
{{ if eq .Type "search" }}
<script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.43/dist/flexsearch.bundle.js" integrity="sha384-XGHyRUKZOaGSzrOTqj7X8+qXrXGqOzOqOqOqOqOqOqOqOqOqOqOqOqOqOqOqOqOq" crossorigin="anonymous"></script>
{{ end }}

<!-- Alpine.js for interactive components -->
{{ if site.Params.features.alpine }}
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
{{ end }}

<!-- Custom JavaScript -->
{{ $js := resources.Get "js/main.js" }}
{{ if $js }}
  {{ if hugo.IsDevelopment }}
    <script src="{{ $js.RelPermalink }}"></script>
  {{ else }}
    {{ with $js | minify | fingerprint }}
      <script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous"></script>
    {{ end }}
  {{ end }}
{{ end }}

<!-- Theme toggle script -->
<script>
// Theme toggle functionality
function initTheme() {
  const theme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', theme);

  // Update theme toggle button if it exists
  const themeToggle = document.querySelector('[data-theme-toggle]');
  if (themeToggle) {
    themeToggle.setAttribute('aria-pressed', theme === 'dark');
  }
}

function toggleTheme() {
  const currentTheme = document.documentElement.getAttribute('data-theme');
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);

  // Update theme toggle button
  const themeToggle = document.querySelector('[data-theme-toggle]');
  if (themeToggle) {
    themeToggle.setAttribute('aria-pressed', newTheme === 'dark');
  }
}

// Initialize theme on page load
document.addEventListener('DOMContentLoaded', initTheme);

// Add theme toggle event listener
document.addEventListener('DOMContentLoaded', function() {
  const themeToggle = document.querySelector('[data-theme-toggle]');
  if (themeToggle) {
    themeToggle.addEventListener('click', toggleTheme);
  }
});
</script>

<!-- Mobile menu script -->
<script>
function toggleMobileMenu() {
  const menu = document.getElementById('mobile-menu');
  const button = document.querySelector('[data-mobile-menu-toggle]');

  if (menu && button) {
    const isOpen = !menu.classList.contains('hidden');

    if (isOpen) {
      menu.classList.add('hidden');
      button.setAttribute('aria-expanded', 'false');
    } else {
      menu.classList.remove('hidden');
      button.setAttribute('aria-expanded', 'true');
    }
  }
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
  const menu = document.getElementById('mobile-menu');
  const button = document.querySelector('[data-mobile-menu-toggle]');

  if (menu && button && !menu.contains(event.target) && !button.contains(event.target)) {
    menu.classList.add('hidden');
    button.setAttribute('aria-expanded', 'false');
  }
});

// Close mobile menu on escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    const menu = document.getElementById('mobile-menu');
    const button = document.querySelector('[data-mobile-menu-toggle]');

    if (menu && button && !menu.classList.contains('hidden')) {
      menu.classList.add('hidden');
      button.setAttribute('aria-expanded', 'false');
    }
  }
});
</script>

<!-- Copy code functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add copy buttons to code blocks
  const codeBlocks = document.querySelectorAll('pre code');

  codeBlocks.forEach(function(codeBlock) {
    const pre = codeBlock.parentElement;
    const button = document.createElement('button');

    button.className = 'absolute top-2 right-2 px-2 py-1 text-xs bg-[var(--color-neutral-dark)] text-[var(--color-neutral-light)] rounded opacity-0 group-hover:opacity-100 transition-opacity';
    button.textContent = 'Copy';
    button.setAttribute('aria-label', 'Copy code to clipboard');

    // Make pre element relative for absolute positioning
    pre.style.position = 'relative';
    pre.classList.add('group');

    button.addEventListener('click', function() {
      navigator.clipboard.writeText(codeBlock.textContent).then(function() {
        button.textContent = 'Copied!';
        setTimeout(function() {
          button.textContent = 'Copy';
        }, 2000);
      }).catch(function() {
        button.textContent = 'Failed';
        setTimeout(function() {
          button.textContent = 'Copy';
        }, 2000);
      });
    });

    pre.appendChild(button);
  });
});
</script>

<!-- Analytics -->
{{ if site.Params.analytics.googleAnalytics }}
<!-- Google Analytics is loaded in head.html -->
{{ end }}

{{ if site.Params.analytics.googleTagManager }}
<!-- Google Tag Manager (noscript) -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id={{ site.Params.analytics.googleTagManager }}" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
{{ end }}
